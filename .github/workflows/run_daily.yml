# Patch snippet for your existing workflow (keep your name/on/schedule as-is)
# Key fixes:
# 1) Create real files in logs/verify BEFORE running python so upload-artifact always finds something.
# 2) Upload artifacts even if the run step fails (if: always()).
# 3) Copernicus credentials must be provided via GitHub Secrets or strict mode must be turned off.

      - name: Prepare latest dirs (always create real files)
        run: |
          rm -rf docs/latest/verify || true
          rm -rf docs/latest/logs || true
          mkdir -p docs/latest/logs docs/latest/verify
          echo "keep" > docs/latest/logs/keep.txt
          echo "keep" > docs/latest/verify/keep.txt

      - name: Run daily
        shell: bash
        run: |
          set -euo pipefail
          export PYTHONPATH="$GITHUB_WORKSPACE/backend"
          python -m seydyaar run-daily             --out docs/latest             --past-days "${SEYDYAAR_PAST_DAYS:-2}"             --future-days "${SEYDYAAR_FUTURE_DAYS:-8}"             --step-hours "${SEYDYAAR_STEP_HOURS:-6}"             --grid "${SEYDYAAR_GRID:-220x220}"

      - name: Upload logs + verify (even on failure)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: seydyaar_verify_and_logs
          path: |
            docs/latest/logs/**
            docs/latest/verify/**
          include-hidden-files: true
          if-no-files-found: warn
          retention-days: 7
