name: ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù‡ÛŒ ØªÙ†

on:
  workflow_dispatch:

jobs:
  analyze:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯
      uses: actions/checkout@v4
    
    - name: Ù†ØµØ¨ Ù¾Ø§ÛŒØªÙˆÙ†
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
      run: |
        pip install requests xarray netCDF4 numpy pandas
        echo "ğŸ“¦ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ØµØ¨ Ø´Ø¯Ù‡:"
        pip list | grep -E "(requests|xarray|netCDF4|numpy|pandas)"
    
    - name: Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§
      run: |
        mkdir -p data/copernicus
        mkdir -p results
        echo "ğŸ“ Ø³Ø§Ø®ØªØ§Ø± Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§:"
        find . -type d -name "data" -o -name "results" | sort
    
    - name: Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¯Ø§Ø¯Ù‡
      env:
        COPERNICUS_USERNAME: ${{ secrets.COPERNICUS_USERNAME }}
        COPERNICUS_PASSWORD: ${{ secrets.COPERNICUS_PASSWORD }}
      run: |
        echo "ğŸŒŠ Ø´Ø±ÙˆØ¹ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¯Ø§Ø¯Ù‡ Ø§Ø² Copernicus Marine..."
        python backend/download_real_data.py
    
    - name: Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯Ù‡
      run: |
        echo ""
        echo "ğŸ“Š ÙˆØ¶Ø¹ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§:"
        echo "----------------"
        
        echo "1. Ù¾ÙˆØ´Ù‡ data:"
        find data -type f 2>/dev/null || echo "   (Ø®Ø§Ù„ÛŒ)"
        
        echo ""
        echo "2. Ø­Ø¬Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§:"
        if [ -d "data/copernicus" ]; then
          du -sh data/copernicus/*
        else
          echo "   Ù¾ÙˆØ´Ù‡ copernicus ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯"
        fi
        
        echo ""
        echo "3. Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ§ÛŒÙ„ NetCDF:"
        if ls data/copernicus/*.nc 1> /dev/null 2>&1; then
          for file in data/copernicus/*.nc; do
            echo "   ğŸ“„ $file"
            echo "      Ø­Ø¬Ù…: $(ls -lh "$file" | awk '{print $5}')"
            echo "      ØªØ§Ø±ÛŒØ®: $(ls -lh "$file" | awk '{print $6, $7, $8}')"
          done
        else
          echo "   Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ NetCDF ÛŒØ§ÙØª Ù†Ø´Ø¯"
        fi
    
    - name: Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬
      uses: actions/upload-artifact@v4
      with:
        name: Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ-Ø¯Ø±ÛŒØ§ÛŒÛŒ
        path: |
          data/
          results/
        retention-days: 7
