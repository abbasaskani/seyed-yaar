name: ØªØ­Ù„ÛŒÙ„ Ùˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù‡ÛŒ ØªÙ†

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'  # Ù‡Ø± Ø±ÙˆØ² Ù†ÛŒÙ…Ù‡â€ŒØ´Ø¨

jobs:
  analyze:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯
      uses: actions/checkout@v4
    
    - name: Ù†ØµØ¨ Ù¾Ø§ÛŒØªÙˆÙ† Ùˆ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
      run: |
        pip install xarray netCDF4 numpy pandas matplotlib
        echo "ğŸ“¦ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ØµØ¨ Ø´Ø¯Ù‡:"
        pip list | grep -E "(xarray|netCDF4|numpy|pandas|matplotlib)"
    
    - name: Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§
      run: |
        mkdir -p data/noaa_sst
        mkdir -p results
        mkdir -p reports
        mkdir -p charts
        mkdir -p trends
        mkdir -p website
        echo "ğŸ“ Ø³Ø§Ø®ØªØ§Ø± Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯"
    
    - name: Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡
      run: |
        echo "ğŸŒŠ Ø´Ø±ÙˆØ¹ Ø¯Ø±ÛŒØ§ÙØª Ùˆ ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§..."
        python backend/download_public_data.py
    
    - name: Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
      run: |
        echo "ğŸ“Š Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ÛŒ..."
        python backend/generate_report.py
    
    - name: Ø§ÛŒØ¬Ø§Ø¯ ÙˆØ¨â€ŒØ³Ø§ÛŒØª
      run: |
        echo "ğŸŒ Ø§ÛŒØ¬Ø§Ø¯ ØµÙØ­Ù‡ ÙˆØ¨ Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬..."
        python backend/create_website.py
    
    - name: Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ Ù†Ù‡Ø§ÛŒÛŒ
      run: |
        echo ""
        echo "ğŸ“‹ Ù†ØªØ§ÛŒØ¬ Ù†Ù‡Ø§ÛŒÛŒ:"
        echo "--------------"
        
        echo "ğŸ“ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø±ÙˆÚ˜Ù‡:"
        find . -type d -name "data" -o -name "results" -o -name "reports" -o -name "charts" -o -name "trends" -o -name "website" | sort
        
        echo ""
        echo "ğŸ“„ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡:"
        find reports/ -name "*.txt" 2>/dev/null | head -3 || echo "   (Ú¯Ø²Ø§Ø±Ø´ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯)"
        
        echo ""
        echo "ğŸ“ˆ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§:"
        find charts/ -name "*.png" 2>/dev/null | head -3 || echo "   (Ù†Ù…ÙˆØ¯Ø§Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯)"
        
        echo ""
        echo "ğŸŒ ÙØ§ÛŒÙ„ ÙˆØ¨â€ŒØ³Ø§ÛŒØª:"
        find website/ -name "*.html" 2>/dev/null || echo "   (ÙØ§ÛŒÙ„ HTML ÛŒØ§ÙØª Ù†Ø´Ø¯)"
        
        echo ""
        echo "ğŸ“Š Ø¢Ø®Ø±ÛŒÙ† ØªØ­Ù„ÛŒÙ„ Ø¯Ù…Ø§:"
        if ls results/*.json 1> /dev/null 2>&1; then
          latest_json=$(ls -t results/*.json | head -1)
          echo "   ÙØ§ÛŒÙ„: $(basename $latest_json)"
          cat $latest_json
        fi
    
    - name: Ø°Ø®ÛŒØ±Ù‡ Ù‡Ù…Ù‡ Ù†ØªØ§ÛŒØ¬
      uses: actions/upload-artifact@v4
      with:
        name: fishing-results  # Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø´Ø¯Ù‡!
        path: |
          data/
          results/
          reports/
          charts/
          trends/
          website/
        retention-days: 30
    
    - name: Ø§Ø±Ø³Ø§Ù„ Ø§Ø¹Ù„Ø§Ù† Ù…ÙˆÙÙ‚ÛŒØª
      if: success()
      run: |
        echo "âœ… ØªØ­Ù„ÛŒÙ„ Ø±ÙˆØ²Ø§Ù†Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!"
        echo "ğŸ“Š Ù†ØªØ§ÛŒØ¬ Ú©Ø§Ù…Ù„ Ø¯Ø± Artifacts Ø¨Ø§ Ù†Ø§Ù… 'fishing-results' Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª"
        echo "ğŸ• Ø²Ù…Ø§Ù†: $(date)"
