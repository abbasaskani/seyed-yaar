name: ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù‡ÛŒ ØªÙ†

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'  # Ù‡Ø± Ø±ÙˆØ² Ù†ÛŒÙ…Ù‡â€ŒØ´Ø¨

jobs:
  analyze:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯
      uses: actions/checkout@v4
    
    - name: Ù†ØµØ¨ Ù¾Ø§ÛŒØªÙˆÙ†
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
      run: |
        pip install xarray netCDF4 numpy pandas
        echo "ğŸ“¦ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ØµØ¨ Ø´Ø¯Ù‡:"
        pip list | grep -E "(xarray|netCDF4|numpy|pandas)"
    
    - name: Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§
      run: |
        mkdir -p data/noaa_sst
        mkdir -p results
        echo "ğŸ“ Ø³Ø§Ø®ØªØ§Ø± Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯"
    
    - name: ØªØ³Øª Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª
      run: |
        echo "ğŸ” ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø§ÛŒÙ†ØªØ±Ù†Øª..."
        timeout 10 curl -I https://noaa.gov || echo "Ø®Ø·Ø§ÛŒ curlØŒ Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…..."
    
    - name: Ø§Ø¬Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡
      run: |
        echo "ğŸŒŠ Ø´Ø±ÙˆØ¹ ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÛŒÛŒ..."
        python backend/download_public_data.py
    
    - name: Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
      run: |
        echo ""
        echo "ğŸ“‹ Ù†ØªØ§ÛŒØ¬ Ù†Ù‡Ø§ÛŒÛŒ:"
        echo "--------------"
        
        # Ù†Ù…Ø§ÛŒØ´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡
        echo "ğŸ“ Ù…Ø­ØªÙˆØ§ÛŒ Ù¾ÙˆØ´Ù‡ data:"
        find data -name "*.nc" -type f 2>/dev/null | head -5 || echo "   (ÙØ§ÛŒÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯)"
        
        echo ""
        echo "ğŸ“„ Ù…Ø­ØªÙˆØ§ÛŒ Ù¾ÙˆØ´Ù‡ results:"
        ls -la results/ 2>/dev/null || echo "   Ù¾ÙˆØ´Ù‡ results Ø®Ø§Ù„ÛŒ Ø§Ø³Øª"
        
        # Ù†Ù…Ø§ÛŒØ´ Ø¢Ø®Ø±ÛŒÙ† ÙØ§ÛŒÙ„ JSON
        if ls results/*.json 1> /dev/null 2>&1; then
          echo ""
          echo "ğŸ“Š Ù†ØªØ§ÛŒØ¬ ØªØ­Ù„ÛŒÙ„:"
          latest_json=$(ls -t results/*.json | head -1)
          cat "$latest_json"
        fi
    
    - name: Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬
      uses: actions/upload-artifact@v4
      with:
        name: Ù†ØªØ§ÛŒØ¬-Ù…Ø§Ù‡ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ
        path: |
          data/
          results/
        retention-days: 30
    
    - name: Ø§Ø±Ø³Ø§Ù„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
      if: success()
      run: |
        echo "âœ… ØªØ­Ù„ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!"
        echo "ğŸ“Š Ù†ØªØ§ÛŒØ¬ Ø¯Ø± Ø¨Ø®Ø´ Artifacts Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª"
