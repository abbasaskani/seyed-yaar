name: ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù‡ÛŒ ØªÙ†

on:
  workflow_dispatch:  # ÙÙ‚Ø· Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ

jobs:
  analyze:
    runs-on: ubuntu-latest
    
    steps:
    # Ù…Ø±Ø­Ù„Ù‡ Û±: Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯
    - name: Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯
      uses: actions/checkout@v3
    
    # Ù…Ø±Ø­Ù„Ù‡ Û²: Ù†ØµØ¨ Ù¾Ø§ÛŒØªÙˆÙ†
    - name: Ù†ØµØ¨ Ù¾Ø§ÛŒØªÙˆÙ†
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    # Ù…Ø±Ø­Ù„Ù‡ Û³: Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§
    - name: Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§
      run: |
        mkdir -p data
        mkdir -p results
        echo "ğŸ“ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù†Ø¯"
        ls -la
    
    # Ù…Ø±Ø­Ù„Ù‡ Û´: Ø§Ø¬Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„
    - name: Ø§Ø¬Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„
      env:
        COPERNICUS_USERNAME: ${{ secrets.COPERNICUS_USERNAME }}
        COPERNICUS_PASSWORD: ${{ secrets.COPERNICUS_PASSWORD }}
      run: |
        echo "ğŸ¬ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª..."
        python backend/run_daily.py
    
    # Ù…Ø±Ø­Ù„Ù‡ Ûµ: Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
    - name: Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
      run: |
        echo ""
        echo "ğŸ“‹ Ù†ØªØ§ÛŒØ¬ Ø§Ø¬Ø±Ø§:"
        echo "--------------"
        if ls results/*.txt 1> /dev/null 2>&1; then
          echo "âœ… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡:"
          ls -la results/*.txt
          echo ""
          echo "ğŸ“„ Ù…Ø­ØªÙˆØ§ÛŒ Ø¢Ø®Ø±ÛŒÙ† ÙØ§ÛŒÙ„:"
          cat results/$(ls -t results/*.txt | head -1)
        else
          echo "âŒ Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯"
        fi
    
    # Ù…Ø±Ø­Ù„Ù‡ Û¶: Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬
    - name: Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬
      uses: actions/upload-artifact@v3
      with:
        name: Ù†ØªØ§ÛŒØ¬-ØªØ­Ù„ÛŒÙ„
        path: results/
